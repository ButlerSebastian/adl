{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/agent-definition.json",
  "title": "Agent Definition",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this agent (UUID or similar)."
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version number of this agent definition. For semantic versioning, use version_string field."
    },
    "version_string": {
      "type": "string",
      "description": "Semantic version string (e.g., '1.2.0') for the agent definition.",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
    },
    "lifecycle": {
      "type": "string",
      "enum": [
        "stable",
        "beta",
        "deprecated",
        "experimental"
      ],
      "description": "Lifecycle status of this agent version."
    },
    "compatibility": {
      "type": "object",
      "description": "Compatibility information for this agent version.",
      "additionalProperties": false,
      "properties": {
        "adl_spec": {
          "type": "string",
          "description": "Minimum ADL spec version required (e.g., '>=1.0.0')."
        },
        "previous_versions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of compatible previous version patterns."
        }
      }
    },
    "change_log": {
      "type": "object",
      "description": "Change log information for this version.",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "breaking",
            "non-breaking",
            "patch"
          ],
          "description": "Type of change in this version."
        },
        "summary": {
          "type": "string",
          "description": "Human-readable summary of changes."
        },
        "details": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Detailed list of changes."
        }
      },
      "required": [
        "type"
      ]
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the agent."
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the agent\u2019s purpose and behavior."
    },
    "role": {
      "type": "string",
      "description": "Short role label for the agent (e.g., 'Creative Producer')."
    },
    "llm": {
      "type": "string",
      "description": "Identifier of the primary LLM provider or model family used by this agent (e.g., 'openai')."
    },
    "llm_settings": {
      "type": "object",
      "description": "Model configuration settings for the LLM.",
      "additionalProperties": false,
      "properties": {
        "temperature": {
          "type": "number",
          "minimum": 0,
          "description": "Sampling temperature for the LLM."
        },
        "max_tokens": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum tokens to generate in a single completion."
        }
      },
      "required": [
        "temperature",
        "max_tokens"
      ]
    },
    "owner": {
      "type": "string",
      "description": "Owner or namespace for this agent (e.g., 'admin')."
    },
    "document_index_id": {
      "type": "string",
      "description": "Primary RAG index identifier associated with this agent, if any."
    },
    "rag": {
      "type": "array",
      "description": "Associated RAG index configurations this agent can use.",
      "items": {
        "$ref": "#/$defs/RagIndex"
      }
    },
    "tools": {
      "type": "array",
      "description": "Tools that this agent can call during reasoning and execution.",
      "items": {
        "$ref": "#/$defs/ToolDefinition"
      }
    },
    "memory": {
      "type": "object",
      "description": "Memory configuration for the agent, defining how it stores, retrieves, and governs state across interactions.",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "episodic",
            "semantic",
            "working",
            "hybrid"
          ],
          "description": "Type of memory system."
        },
        "scope": {
          "type": "string",
          "enum": [
            "session",
            "user",
            "org",
            "global"
          ],
          "description": "Scope of memory visibility and sharing."
        },
        "backend": {
          "type": "string",
          "enum": [
            "vector",
            "kv",
            "graph",
            "external"
          ],
          "description": "Backend storage type for memory."
        },
        "retention": {
          "type": "object",
          "description": "Retention policy for memory data.",
          "additionalProperties": false,
          "properties": {
            "policy": {
              "type": "string",
              "enum": [
                "ttl",
                "versioned",
                "append-only"
              ],
              "description": "Retention policy type."
            },
            "duration": {
              "type": "string",
              "description": "Duration for retention (e.g., '30d', '7d', '1h')."
            }
          },
          "required": [
            "policy"
          ]
        },
        "write_policy": {
          "type": "string",
          "enum": [
            "explicit",
            "implicit"
          ],
          "description": "When memory writes occur."
        },
        "read_policy": {
          "type": "string",
          "enum": [
            "on_demand",
            "always"
          ],
          "description": "When memory reads occur."
        },
        "privacy": {
          "type": "object",
          "description": "Privacy and security settings for memory.",
          "additionalProperties": false,
          "properties": {
            "pii": {
              "type": "boolean",
              "description": "Whether memory may contain personally identifiable information."
            },
            "encryption": {
              "type": "boolean",
              "description": "Whether memory data should be encrypted at rest."
            }
          }
        }
      }
    },
    "agent_roles": {
      "type": "array",
      "description": "Multi-agent role definitions for coordinated agent teams.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "role_id": {
            "type": "string",
            "description": "Unique identifier for this role instance."
          },
          "role_type": {
            "type": "string",
            "enum": [
              "Coordinator",
              "Worker",
              "Supervisor",
              "Critic"
            ],
            "description": "Type of role in the multi-agent system."
          },
          "capabilities": {
            "type": "array",
            "description": "List of capabilities this role provides.",
            "items": {
              "type": "string"
            }
          },
          "constraints": {
            "type": "object",
            "description": "Constraints on this role's behavior.",
            "additionalProperties": false,
            "properties": {
              "max_concurrent_tasks": {
                "type": "integer",
                "minimum": 1,
                "description": "Maximum number of concurrent tasks this role can handle."
              },
              "allowed_tools": {
                "type": "array",
                "description": "List of tool names this role is allowed to use.",
                "items": {
                  "type": "string"
                }
              },
              "forbidden_tools": {
                "type": "array",
                "description": "List of tool names this role is forbidden from using.",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "communication": {
            "type": "object",
            "description": "Communication protocols for this role.",
            "additionalProperties": false,
            "properties": {
              "can_receive_from": {
                "type": "array",
                "description": "List of role types this role can receive messages from.",
                "items": {
                  "type": "string",
                  "enum": [
                    "Coordinator",
                    "Worker",
                    "Supervisor",
                    "Critic"
                  ]
                }
              },
              "can_send_to": {
                "type": "array",
                "description": "List of role types this role can send messages to.",
                "items": {
                  "type": "string",
                  "enum": [
                    "Coordinator",
                    "Worker",
                    "Supervisor",
                    "Critic"
                  ]
                }
              }
            }
          }
        },
        "required": [
          "role_id",
          "role_type"
        ]
      }
    }
  },
  "required": [
    "name",
    "description",
    "role",
    "llm",
    "llm_settings",
    "tools"
  ],
  "$defs": {
    "RagIndex": {
      "title": "RAG Index Definition",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique ID of the RAG index."
        },
        "name": {
          "type": "string",
          "description": "Human-readable name for the RAG index."
        },
        "rag_type": {
          "type": "string",
          "description": "Type of RAG index (e.g., 'doc', 'code', 'image')."
        },
        "virtual_index_path": {
          "type": "string",
          "description": "Virtual path or logical mount point under which this index is exposed."
        },
        "location_type": {
          "type": "string",
          "description": "Location type, e.g., 'local', 's3', 'gcs', etc."
        },
        "remote_path": {
          "type": [
            "string",
            "null"
          ],
          "description": "Optional remote path or bucket/key for the index."
        },
        "metadata": {
          "type": "object",
          "description": "Arbitrary metadata associated with this RAG index.",
          "additionalProperties": true
        }
      },
      "required": [
        "id",
        "name",
        "rag_type",
        "virtual_index_path",
        "location_type",
        "metadata"
      ]
    },
    "ToolDefinition": {
      "title": "Tool Definition",
      "type": "object",
      "description": "A callable tool the agent can invoke. Supports both simple RAG tools and rich capability-style tools.",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Optional unique identifier for the tool (e.g., UUID)."
        },
        "tool_id": {
          "type": "string",
          "description": "Optional external or catalog ID for this tool."
        },
        "version": {
          "type": "integer",
          "minimum": 1,
          "description": "Optional version number of the tool definition."
        },
        "name": {
          "type": "string",
          "description": "Code-readable tool name used for invocation."
        },
        "display_name": {
          "type": "string",
          "description": "Human-friendly display name for UI surfaces."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of what this tool does and how the agent should use it."
        },
        "category": {
          "type": "string",
          "description": "Optional hierarchical category ID following taxonomy specification (e.g., 'data_access.database.query', 'ai_ml.image_generation.text_to_image').",
          "pattern": "^[a-z_]+(?:\\.[a-z_]+){1,3}$"
        },
        "subcategory": {
          "type": "string",
          "description": "Optional subcategory for specific implementation (e.g., 'sql', 'dalle', 'postgresql').",
          "pattern": "^[a-z0-9_-]+$"
        },
        "parameters": {
          "type": "array",
          "description": "List of parameters this tool accepts.",
          "items": {
            "$ref": "#/$defs/ToolParameter"
          }
        },
        "returns": {
          "type": "object",
          "description": "Optional schema for the tool's return value.",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "description": "Return type category",
              "enum": [
                "ObjectResult",
                "EntityResult",
                "OperationStatus",
                "StringValue",
                "NumberValue",
                "BooleanValue",
                "IdentifierValue",
                "ListResult",
                "BatchResult",
                "FileResult",
                "MediaResult",
                "EventStream",
                "ChunkedData",
                "VoidResult",
                "Custom"
              ]
            },
            "schema": {
              "oneOf": [
                {
                  "type": "object"
                },
                {
                  "type": "string",
                  "format": "uri"
                }
              ],
              "description": "JSON Schema or reference to schema definition"
            },
            "description": {
              "type": "string",
              "description": "Human-readable description of the return value"
            },
            "examples": {
              "type": "array",
              "description": "Example return values",
              "items": {}
            },
            "content_type": {
              "type": "string",
              "description": "MIME type of the return value",
              "default": "application/json"
            }
          },
          "required": [
            "type",
            "schema"
          ]
        },
        "dependencies": {
          "type": "array",
          "description": "Optional list of runtime dependencies (e.g., pip packages with optional pinned versions).",
          "items": {
            "type": "string"
          }
        },
        "keys_schema": {
          "type": "array",
          "description": "Optional key / credential schema, typically for environment variables.",
          "items": {
            "$ref": "#/$defs/KeySchemaItem"
          }
        },
        "sources": {
          "type": "array",
          "description": "Optional list of source references for this tool (e.g., repos, docs).",
          "items": {
            "type": "string"
          }
        },
        "permissions": {
          "type": "object",
          "description": "Optional sandbox permissions for this tool.",
          "additionalProperties": false,
          "properties": {
            "network": {
              "type": "boolean",
              "description": "Whether outbound network access is allowed."
            },
            "file_read": {
              "type": "array",
              "description": "List of directories or paths this tool may read from.",
              "items": {
                "type": "string"
              }
            },
            "file_write": {
              "type": "array",
              "description": "List of directories or paths this tool may write to.",
              "items": {
                "type": "string"
              }
            },
            "env_vars": {
              "type": "array",
              "description": "List of environment variable names this tool may access.",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "visibility": {
          "type": "string",
          "description": "Visibility of this tool, e.g., 'public', 'private'."
        },
        "status": {
          "type": "string",
          "description": "Lifecycle status of this tool, e.g., 'active', 'deprecated'."
        },
        "code_file": {
          "type": "string",
          "description": "Relative path to the Python file implementing this tool."
        },
        "created_by": {
          "type": "string",
          "description": "User or system that created this tool definition."
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp of when this tool was created."
        },
        "invocation": {
          "type": "object",
          "description": "Invocation configuration for this tool (how the agent should call it).",
          "additionalProperties": false,
          "properties": {
            "type": {
              "type": "string",
              "description": "Invocation type (e.g., 'python_function', 'http_endpoint')."
            },
            "function": {
              "type": "string",
              "description": "Optional function name or entrypoint when type is 'python_function'."
            }
          },
          "required": [
            "type"
          ]
        }
      },
      "required": [
        "name",
        "description",
        "parameters"
      ]
    },
    "ToolParameter": {
      "title": "Tool Parameter",
      "type": "object",
      "description": "Definition of a single parameter accepted by a tool, with enhanced type constraints for validation (see enhanced-type-system.md).",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Parameter name as used in the tool\u2019s function signature or input schema."
        },
        "type": {
          "type": "string",
          "description": "Logical type of the parameter (e.g., 'string', 'number', 'boolean', 'object')."
        },
        "description": {
          "type": "string",
          "description": "Human-readable explanation of the parameter."
        },
        "required": {
          "type": "boolean",
          "description": "Whether this parameter is required.",
          "default": false
        },
        "default": {
          "description": "Optional default value if the parameter is omitted.",
          "type": [
            "string",
            "number",
            "boolean",
            "object",
            "array",
            "null"
          ]
        },
        "format": {
          "type": "string",
          "description": "String format validation (e.g., 'email', 'uri', 'uuid', 'date-time', 'ipv4', 'ipv6')."
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for string validation (ECMA-262)."
        },
        "minLength": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum string length."
        },
        "maxLength": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum string length."
        },
        "minimum": {
          "type": "number",
          "description": "Minimum numeric value (inclusive)."
        },
        "maximum": {
          "type": "number",
          "description": "Maximum numeric value (inclusive)."
        },
        "exclusiveMinimum": {
          "type": "number",
          "description": "Minimum numeric value (exclusive)."
        },
        "exclusiveMaximum": {
          "type": "number",
          "description": "Maximum numeric value (exclusive)."
        },
        "multipleOf": {
          "type": "number",
          "exclusiveMinimum": 0,
          "description": "Value must be multiple of this number."
        },
        "enum": {
          "type": "array",
          "description": "Allowed values for the parameter."
        },
        "items": {
          "description": "Schema for array items (when type is 'array')."
        },
        "minItems": {
          "type": "integer",
          "minimum": 0,
          "description": "Minimum array length."
        },
        "maxItems": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum array length."
        },
        "uniqueItems": {
          "type": "boolean",
          "default": false,
          "description": "Array items must be unique."
        },
        "properties": {
          "type": "object",
          "description": "Object property schemas (when type is 'object')."
        },
        "required_properties": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required object properties."
        },
        "additionalProperties": {
          "description": "Allow additional object properties (boolean or schema)."
        },
        "anyOf": {
          "type": "array",
          "description": "Union type schemas (value matches any)."
        },
        "oneOf": {
          "type": "array",
          "description": "Exclusive type schemas (value matches exactly one)."
        },
        "allOf": {
          "type": "array",
          "description": "Intersection type schemas (value matches all)."
        }
      },
      "required": [
        "name",
        "type",
        "description"
      ]
    },
    "KeySchemaItem": {
      "title": "Key Schema Item",
      "type": "object",
      "description": "Definition of a required key (typically for environment-based configuration).",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the key or environment variable."
        },
        "description": {
          "type": "string",
          "description": "Description of what this key is used for."
        },
        "key_type": {
          "type": "string",
          "description": "Type of key, e.g., 'environment_variable', 'api_key', etc."
        }
      },
      "required": [
        "name",
        "description",
        "key_type"
      ]
    },
    "MemoryDefinition": {
      "title": "Memory Definition",
      "type": "object",
      "description": "Memory configuration for the agent, defining how it stores, retrieves, and governs state across interactions.",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "episodic",
            "semantic",
            "working",
            "hybrid"
          ],
          "description": "Type of memory system."
        },
        "scope": {
          "type": "string",
          "enum": [
            "session",
            "user",
            "org",
            "global"
          ],
          "description": "Scope of memory visibility and sharing."
        },
        "backend": {
          "type": "string",
          "enum": [
            "vector",
            "kv",
            "graph",
            "external"
          ],
          "description": "Backend storage type for memory."
        },
        "retention": {
          "type": "object",
          "description": "Retention policy for memory data.",
          "additionalProperties": false,
          "properties": {
            "policy": {
              "type": "string",
              "enum": [
                "ttl",
                "versioned",
                "append-only"
              ],
              "description": "Retention policy type."
            },
            "duration": {
              "type": "string",
              "description": "Duration for retention (e.g., '30d', '7d', '1h')."
            }
          },
          "required": [
            "policy"
          ]
        },
        "write_policy": {
          "type": "string",
          "enum": [
            "explicit",
            "implicit"
          ],
          "description": "When memory writes occur."
        },
        "read_policy": {
          "type": "string",
          "enum": [
            "on_demand",
            "always"
          ],
          "description": "When memory reads occur."
        },
        "privacy": {
          "type": "object",
          "description": "Privacy and security settings for memory.",
          "additionalProperties": false,
          "properties": {
            "pii": {
              "type": "boolean",
              "description": "Whether memory may contain personally identifiable information."
            },
            "encryption": {
              "type": "boolean",
              "description": "Whether memory data should be encrypted at rest."
            }
          }
        }
      }
    }
  }
}